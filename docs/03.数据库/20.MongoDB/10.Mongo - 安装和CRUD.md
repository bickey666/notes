---
title: Mongo - 安装和CRUD
date: 2021-09-11 11:24:13
permalink: /pages/f04bc7/
---
## MongoDB安装

### 参考文档

官网下载：<https://www.mongodb.com/try/download/community>

官网文档：<https://docs.mongodb.com/v3.6/administration/install-community/>

菜鸟教程：<https://www.runoob.com/mongodb/mongodb-window-install.html>

### 以Docker为例安装

1、拉取镜像

```sh
docker pull mongo:latest
```

注意：有的服务器不支持新版本，会导致Docker启动失败，具体原因看报错内容

可选择其他版本（我使用的服务器5.0及以上版本都不可使）

```sh
docker pull mongo:4.4.8
```

2、创建和启动容器

以 4.4.8 版本为例 <Badge text="建议加上密码，原因看下方"/>

<code-group>
  <code-block title="不带密码启动" active>

  ```bash
docker run -d --restart=always  --name mymongo \
	-p 27017:27017 \
	-v /data/docker/mongodb:/data/db \
	mongo:4.4.8
  ```
  </code-block>

  <code-block title="带密码启动">
  ```bash
docker run -d --restart=always --name mymongo \
	-p 27017:27017  \
    -e MONGO_INITDB_ROOT_USERNAME=mymongoadmin \
	-e MONGO_INITDB_ROOT_PASSWORD=root123456 \
	-v /data/docker/mongodb:/data/db \
    mongo:4.4.8
  ```
  </code-block>
</code-group>

使用账户密码启动的，需要给数据库创建用户权限：

```sh
db.createUser(
    {
        user:"admin",
        pwd:"root123456",
        roles:[
            {role:"dbOwner",db:"yygh_hosp"}
        ]
    }
)
```

之后sping中MongoDB地址改成：

```properties
spring.data.mongodb.uri=mongodb://admin:root123456@IP:端口/yygh_hosp
```

角色权限说明(role)：

Built-In Roles（内置角色）：
1. 数据库用户角色：read、readWrite; 
2. 数据库管理角色：dbAdmin、dbOwner、userAdmin；
3. 集群管理角色：clusterAdmin、clusterManager、clusterMonitor、hostManager； 
4. 备份恢复角色：backup、restore； 
5. 所有数据库角色：readAnyDatabase、readWriteAnyDatabase、userAdminAnyDatabase、dbAdminAnyDatabase 
6. 超级用户角色：root 



> 这里还有几个角色间接或直接提供了系统超级用户的访问
>
> （dbOwner 、userAdmin、userAdminAnyDatabase）



<Badge text="带密码原因：" type="error" vertical="middle"/>

之前学习 [尚硅谷-尚医通项目](https://www.bilibili.com/video/BV1V5411K7rT?p=163) 用到了MongoDB

我安装到了服务器上，没换端口地址且没设密码

后来某一天，数据库让淦了，所有数据都没了，只剩下个勒索数据：

![image-20210911115120977](https://cdn.jsdelivr.net/gh/oddfar/static/img/MongoDB/image-20210911115120977.png)

翻译后：

![image-20210911115316142](https://cdn.jsdelivr.net/gh/oddfar/static/img/MongoDB/image-20210911115316142.png)

还好只是学习的测试数据，不然就完犊子了

百度了一下参考了 [mongoDB 数据莫名其妙的没了](https://blog.csdn.net/u013513053/article/details/105785980/) 这篇文章，才知道数据库是被黑了

## 连接和建库

进入容器 

```sh
docker exec -it mymongo /bin/bash 
```

连接mongo


```sh
mongo -u mymongoadmin -p root123456
```



```sh
#查看数据库
show dbs;
```

